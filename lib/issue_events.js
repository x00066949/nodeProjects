/*istanbul ignore next*/'use strict';

var /*istanbul ignore next*/_debug = require('debug');

/*istanbul ignore next*/var _debug2 = _interopRequireDefault(_debug);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _ = require('lodash');
var rp = require('request-promise');
var Regex = require('regex');
var dateFormat = require('dateformat');

// Setup debug log

var log = /*istanbul ignore next*/(0, _debug2.default)('watsonwork-scrumbot');

module.exports = {

    parseResponse: function /*istanbul ignore next*/parseResponse(req, res) {
        log('parseresponse');

        var UrlOptions = {
            uri: 'https://www.github.com/'
            /*qs: {
            },
            headers: {
                'User-Agent': 'Request-Promise'
            },
            json: true // Automatically parses the JSON string in the response*/
        };

        return rp(UrlOptions).then(function () {

            var FinalMessage = '';

            //COMMENTS
            if (req.get('X-Github-Event') === 'issue_comment') {
                log('action: ' + req.body.action);

                FinalMessage = 'A Comment has just been ';

                if (req.body.action === 'created') {
                    FinalMessage += 'added to issue #' + req.body.issue.number + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id + ' by user ' + req.body.comment.user.login + '\n The comment can be found here : ' + req.body.comment.html_url + '. \n The content of the comment is : \n' + req.body.comment.body;
                } else if (req.body.action === 'edited') {
                    FinalMessage += 'edited under issue #' + req.body.issue.number + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id + ' by user ' + req.body.comment.user.login + '\n The comment can be found here : ' + req.body.comment.html_url + '. \n The content of the comment is : \n' + req.body.comment.body;
                } else if (req.body.action === 'deleted') {
                    FinalMessage = 'Comment content : _"' + req.body.comment.body + '"_\nThe above comment was deleted under issue #' + req.body.issue.number + ' by user ' + req.body.comment.user.login + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id;
                } else {
                    FinalMessage += req.body.action + ' action not coded yet...coming soon';
                }
            }
            //ISSUES
            else if (req.get('X-Github-Event') === 'issues') {
                    log('action: ' + req.body.action);

                    FinalMessage = 'An issue has just been ';

                    if (req.body.action === 'opened') {
                        FinalMessage += 'opened in repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\nIssue Details:\nIssue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title;
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\nThe following labels were added: ';
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += '\n Issue opened by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + '.';
                    } else if (req.body.action === 'closed') {
                        FinalMessage += 'closed. ' + '\nIssue Details:\nIssue Number : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + '\n Issue closed by : ' + req.body.issue.user.login + '\nIn repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '.';
                    } else if (req.body.action === 'reopened') {
                        FinalMessage += 'reopened in repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Issue Re-opened by : ' + req.body.issue.user.login + '\nIssue Details:\nIssue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + '\n The Issue can be found here : ' + req.body.issue.html_url + '.';
                    } else if (req.body.action === 'labeled') {
                        FinalMessage = 'Issue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + ' has been updated with the following labels: ';
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += 'In repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Label added by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + ' .';
                    } else if (req.body.action === 'unlabeled') {
                        FinalMessage = 'The following label : \n\t' + req.body.label.name;

                        FinalMessage += '\n Has been removed from Issue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title;
                        FinalMessage += 'In repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Label removed by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + ' .';
                    } else {
                        FinalMessage = req.body.action + ' action not coded yet...coming soon';
                    }
                } else {
                    log('Event type: ' + req.get('X-Github-Event'));
                    FinalMessage = 'Event type : ' + req.get('X-Github-Event') + ' in board. (NOT coded yet...Coming soon)';
                }
            log(FinalMessage);
            return FinalMessage;
        });
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pc3N1ZV9ldmVudHMuanMiXSwibmFtZXMiOlsiXyIsInJlcXVpcmUiLCJycCIsIlJlZ2V4IiwiZGF0ZUZvcm1hdCIsImxvZyIsIm1vZHVsZSIsImV4cG9ydHMiLCJwYXJzZVJlc3BvbnNlIiwicmVxIiwicmVzIiwiVXJsT3B0aW9ucyIsInVyaSIsInRoZW4iLCJGaW5hbE1lc3NhZ2UiLCJnZXQiLCJib2R5IiwiYWN0aW9uIiwiaXNzdWUiLCJudW1iZXIiLCJyZXBvc2l0b3J5IiwibmFtZSIsImlkIiwiY29tbWVudCIsInVzZXIiLCJsb2dpbiIsImh0bWxfdXJsIiwidGl0bGUiLCJpIiwibGFiZWxzIiwibGVuZ3RoIiwibGFiZWwiXSwibWFwcGluZ3MiOiI7O0FBTUE7Ozs7OztBQU5BLElBQUlBLElBQUlDLFFBQVEsUUFBUixDQUFSO0FBQ0EsSUFBSUMsS0FBS0QsUUFBUSxpQkFBUixDQUFUO0FBQ0EsSUFBSUUsUUFBUUYsUUFBUSxPQUFSLENBQVo7QUFDQSxJQUFJRyxhQUFhSCxRQUFRLFlBQVIsQ0FBakI7O0FBRUE7O0FBRUEsSUFBTUksTUFBTSw2Q0FBTSxxQkFBTixDQUFaOztBQUVBQyxPQUFPQyxPQUFQLEdBQWlCOztBQUViQyxtQkFBZ0IsK0NBQVVDLEdBQVYsRUFBZUMsR0FBZixFQUFvQjtBQUNoQ0wsWUFBSSxlQUFKOztBQUVBLFlBQUlNLGFBQWE7QUFDYkMsaUJBQUs7QUFDTDs7Ozs7O0FBRmEsU0FBakI7O0FBVUEsZUFBT1YsR0FBR1MsVUFBSCxFQUFlRSxJQUFmLENBQW9CLFlBQVk7O0FBRW5DLGdCQUFJQyxlQUFlLEVBQW5COztBQUVBO0FBQ0EsZ0JBQUlMLElBQUlNLEdBQUosQ0FBUSxnQkFBUixNQUE4QixlQUFsQyxFQUFtRDtBQUMvQ1Ysb0JBQUksYUFBYUksSUFBSU8sSUFBSixDQUFTQyxNQUExQjs7QUFFQUgsK0JBQWUsMEJBQWY7O0FBRUEsb0JBQUlMLElBQUlPLElBQUosQ0FBU0MsTUFBVCxLQUFvQixTQUF4QixFQUFt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QUFJTyxJQUFKLENBQVNJLFVBQVQsQ0FBb0JDLElBQXZDLEdBQThDLGlCQUE5QyxHQUFrRVosSUFBSU8sSUFBSixDQUFTSSxVQUFULENBQW9CRSxFQUF0RixHQUEyRix3QkFBM0YsR0FBc0hiLElBQUlPLElBQUosQ0FBU0UsS0FBVCxDQUFlTSxJQUFmLENBQW9CQyxLQUExSSxHQUFrSixtQ0FBbEosR0FBd0xoQixJQUFJTyxJQUFKLENBQVNFLEtBQVQsQ0FBZVEsUUFBdk0sR0FBa04sSUFBbE87QUFDSCxxQkFMTSxNQU1GO0FBQ0RaLHVDQUFlTCxJQUFJTyxJQUFKLENBQVNDLE1BQVQsR0FBa0IscUNBQWpDO0FBQ0g7QUFDSixpQkEvQkksTUFnQ0E7QUFDRFosd0JBQUksaUJBQWlCSSxJQUFJTSxHQUFKLENBQVEsZ0JBQVIsQ0FBckI7QUFDQUQsbUNBQWUsa0JBQWtCTCxJQUFJTSxHQUFKLENBQVEsZ0JBQVIsQ0FBbEIsR0FBOEMsMENBQTdEO0FBQ0g7QUFDRFYsZ0JBQUlTLFlBQUo7QUFDQSxtQkFBT0EsWUFBUDtBQUNILFNBOURNLENBQVA7QUErREg7QUE5RVksQ0FBakIiLCJmaWxlIjoiaXNzdWVfZXZlbnRzLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbnZhciBycCA9IHJlcXVpcmUoJ3JlcXVlc3QtcHJvbWlzZScpO1xudmFyIFJlZ2V4ID0gcmVxdWlyZSgncmVnZXgnKTtcbnZhciBkYXRlRm9ybWF0ID0gcmVxdWlyZSgnZGF0ZWZvcm1hdCcpO1xuXG4vLyBTZXR1cCBkZWJ1ZyBsb2dcbmltcG9ydCBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5jb25zdCBsb2cgPSBkZWJ1Zygnd2F0c29ud29yay1zY3J1bWJvdCcpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICAgIHBhcnNlUmVzcG9uc2U6IChmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgICAgICAgbG9nKCdwYXJzZXJlc3BvbnNlJylcbiAgICAgICAgXG4gICAgICAgIHZhciBVcmxPcHRpb25zID0ge1xuICAgICAgICAgICAgdXJpOiAnaHR0cHM6Ly93d3cuZ2l0aHViLmNvbS8nLFxuICAgICAgICAgICAgLypxczoge1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdSZXF1ZXN0LVByb21pc2UnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAganNvbjogdHJ1ZSAvLyBBdXRvbWF0aWNhbGx5IHBhcnNlcyB0aGUgSlNPTiBzdHJpbmcgaW4gdGhlIHJlc3BvbnNlKi9cbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gcnAoVXJsT3B0aW9ucykudGhlbihmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciBGaW5hbE1lc3NhZ2UgPSAnJztcblxuICAgICAgICAgICAgLy9DT01NRU5UU1xuICAgICAgICAgICAgaWYgKHJlcS5nZXQoJ1gtR2l0aHViLUV2ZW50JykgPT09ICdpc3N1ZV9jb21tZW50Jykge1xuICAgICAgICAgICAgICAgIGxvZygnYWN0aW9uOiAnICsgcmVxLmJvZHkuYWN0aW9uKVxuXG4gICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID0gJ0EgQ29tbWVudCBoYXMganVzdCBiZWVuICdcblxuICAgICAgICAgICAgICAgIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdjcmVhdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ2FkZGVkIHRvIGlzc3VlICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJyBpbiByZXBvc2l0b3J5ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5Lm5hbWUgKyAnIHdpdGggSUQgOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICcgYnkgdXNlciAnICsgcmVxLmJvZHkuY29tbWVudC51c2VyLmxvZ2luICsgJ1xcbiBUaGUgY29tbWVudCBjYW4gYmUgZm91bmQgaGVyZSA6ICcgKyByZXEuYm9keS5jb21tZW50Lmh0bWxfdXJsICsgJy4gXFxuIFRoZSBjb250ZW50IG9mIHRoZSBjb21tZW50IGlzIDogXFxuJyArIHJlcS5ib2R5LmNvbW1lbnQuYm9keTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnZWRpdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ2VkaXRlZCB1bmRlciBpc3N1ZSAjJyArIHJlcS5ib2R5Lmlzc3VlLm51bWJlciArICcgaW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIElEIDogJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkuaWQgKyAnIGJ5IHVzZXIgJyArIHJlcS5ib2R5LmNvbW1lbnQudXNlci5sb2dpbiArICdcXG4gVGhlIGNvbW1lbnQgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuY29tbWVudC5odG1sX3VybCArICcuIFxcbiBUaGUgY29udGVudCBvZiB0aGUgY29tbWVudCBpcyA6IFxcbicgKyByZXEuYm9keS5jb21tZW50LmJvZHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcS5ib2R5LmFjdGlvbiA9PT0gJ2RlbGV0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdDb21tZW50IGNvbnRlbnQgOiBfXCInICsgcmVxLmJvZHkuY29tbWVudC5ib2R5ICsgJ1wiX1xcblRoZSBhYm92ZSBjb21tZW50IHdhcyBkZWxldGVkIHVuZGVyIGlzc3VlICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJyBieSB1c2VyICcgKyByZXEuYm9keS5jb21tZW50LnVzZXIubG9naW4gKyAnIGluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCBJRCA6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9IHJlcS5ib2R5LmFjdGlvbiArICcgYWN0aW9uIG5vdCBjb2RlZCB5ZXQuLi5jb21pbmcgc29vbidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL0lTU1VFU1xuICAgICAgICAgICAgZWxzZSBpZiAocmVxLmdldCgnWC1HaXRodWItRXZlbnQnKSA9PT0gJ2lzc3VlcycpIHtcbiAgICAgICAgICAgICAgICBsb2coJ2FjdGlvbjogJyArIHJlcS5ib2R5LmFjdGlvbilcblxuICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdBbiBpc3N1ZSBoYXMganVzdCBiZWVuICdcblxuICAgICAgICAgICAgICAgIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdvcGVuZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnb3BlbmVkIGluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCByZXBvIGlkOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICdcXG5Jc3N1ZSBEZXRhaWxzOlxcbklzc3VlIElEIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXEuYm9keS5pc3N1ZS5sYWJlbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuVGhlIGZvbGxvd2luZyBsYWJlbHMgd2VyZSBhZGRlZDogJ1xuICAgICAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9ICdcXG5cXHQnICsgcmVxLmJvZHkuaXNzdWUubGFiZWxzW2ldLm5hbWUgKyAnXFxuJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuIElzc3VlIG9wZW5lZCBieSA6ICcgKyByZXEuYm9keS5pc3N1ZS51c2VyLmxvZ2luICsgJ1xcbiBUaGUgSXNzdWUgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuaXNzdWUuaHRtbF91cmwgKyAnLic7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdjbG9zZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnY2xvc2VkLiAnICsgJ1xcbklzc3VlIERldGFpbHM6XFxuSXNzdWUgTnVtYmVyIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZSArICdcXG4gSXNzdWUgY2xvc2VkIGJ5IDogJyArIHJlcS5ib2R5Lmlzc3VlLnVzZXIubG9naW4gKyAnXFxuSW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJy4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAncmVvcGVuZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAncmVvcGVuZWQgaW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJ1xcbiBJc3N1ZSBSZS1vcGVuZWQgYnkgOiAnICsgcmVxLmJvZHkuaXNzdWUudXNlci5sb2dpbiArICdcXG5Jc3N1ZSBEZXRhaWxzOlxcbklzc3VlIElEIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZSArICdcXG4gVGhlIElzc3VlIGNhbiBiZSBmb3VuZCBoZXJlIDogJyArIHJlcS5ib2R5Lmlzc3VlLmh0bWxfdXJsICsgJy4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnbGFiZWxlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID0gJ0lzc3VlIElEIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZSArICcgaGFzIGJlZW4gdXBkYXRlZCB3aXRoIHRoZSBmb2xsb3dpbmcgbGFiZWxzOiAnO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlcS5ib2R5Lmlzc3VlLmxhYmVscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9ICdcXG5cXHQnICsgcmVxLmJvZHkuaXNzdWUubGFiZWxzW2ldLm5hbWUgKyAnXFxuJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnSW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJ1xcbiBMYWJlbCBhZGRlZCBieSA6ICcgKyByZXEuYm9keS5pc3N1ZS51c2VyLmxvZ2luICsgJ1xcbiBUaGUgSXNzdWUgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuaXNzdWUuaHRtbF91cmwgKyAnIC4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAndW5sYWJlbGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgPSAnVGhlIGZvbGxvd2luZyBsYWJlbCA6IFxcblxcdCcgKyByZXEuYm9keS5sYWJlbC5uYW1lO1xuXG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuIEhhcyBiZWVuIHJlbW92ZWQgZnJvbSBJc3N1ZSBJRCA6ICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJ1xcbklzc3VlIFRpdGxlOiAnICsgcmVxLmJvZHkuaXNzdWUudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnSW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJ1xcbiBMYWJlbCByZW1vdmVkIGJ5IDogJyArIHJlcS5ib2R5Lmlzc3VlLnVzZXIubG9naW4gKyAnXFxuIFRoZSBJc3N1ZSBjYW4gYmUgZm91bmQgaGVyZSA6ICcgKyByZXEuYm9keS5pc3N1ZS5odG1sX3VybCArICcgLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgPSByZXEuYm9keS5hY3Rpb24gKyAnIGFjdGlvbiBub3QgY29kZWQgeWV0Li4uY29taW5nIHNvb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbG9nKCdFdmVudCB0eXBlOiAnICsgcmVxLmdldCgnWC1HaXRodWItRXZlbnQnKSlcbiAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgPSAnRXZlbnQgdHlwZSA6ICcgKyByZXEuZ2V0KCdYLUdpdGh1Yi1FdmVudCcpICsgJyBpbiBib2FyZC4gKE5PVCBjb2RlZCB5ZXQuLi5Db21pbmcgc29vbiknXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2coRmluYWxNZXNzYWdlKVxuICAgICAgICAgICAgcmV0dXJuIEZpbmFsTWVzc2FnZTtcbiAgICAgICAgfSk7XG4gICAgfSlcbn07XG4iXX0=