/*istanbul ignore next*/'use strict';

var /*istanbul ignore next*/_debug = require('debug');

/*istanbul ignore next*/var _debug2 = _interopRequireDefault(_debug);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _ = require('lodash');
var rp = require('request-promise');
var Regex = require('regex');
var dateFormat = require('dateformat');

// Setup debug log

var log = /*istanbul ignore next*/(0, _debug2.default)('watsonwork-scrumbot');

module.exports = {

    parseResponse: function /*istanbul ignore next*/parseResponse(req, res) {
        log('parseresponse');
        //var req = options.request;
        //var res = options.response;

        var UrlOptions = {
            uri: 'https://api.github.com/',
            qs: {},
            headers: {
                'User-Agent': 'Request-Promise'
            },
            json: true // Automatically parses the JSON string in the response
        };

        return rp(UrlOptions).then(function () {

            var FinalMessage = '';

            //COMMENTS
            if (req.get('X-Github-Event') === 'issue_comment') {
                log('action: ' + req.body.action);

                FinalMessage = 'A Comment has just been ';

                if (req.body.action === 'created') {
                    FinalMessage += 'added to issue #' + req.body.issue.number + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id + ' by user ' + req.body.comment.user.login + '\n The comment can be found here : ' + req.body.comment.html_url + '. \n The content of the comment is : \n' + req.body.comment.body;
                } else if (req.body.action === 'edited') {
                    FinalMessage += 'edited under issue #' + req.body.issue.number + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id + ' by user ' + req.body.comment.user.login + '\n The comment can be found here : ' + req.body.comment.html_url + '. \n The content of the comment is : \n' + req.body.comment.body;
                } else if (req.body.action === 'deleted') {
                    FinalMessage = 'Comment content : _"' + req.body.comment.body + '"_\nThe above comment was deleted under issue #' + req.body.issue.number + ' by user ' + req.body.comment.user.login + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id;
                } else {
                    FinalMessage += req.body.action + ' action not coded yet...coming soon';
                }
            }
            //ISSUES
            else if (req.get('X-Github-Event') === 'issues') {
                    log('action: ' + req.body.action);

                    FinalMessage = 'An issue has just been ';

                    if (req.body.action === 'opened') {
                        FinalMessage += 'opened in repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\nIssue Details:\nIssue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title;
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\nThe following labels were added: ';
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += '\n Issue opened by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + '.';
                    } else if (req.body.action === 'closed') {
                        FinalMessage += 'closed. ' + '\nIssue Details:\nIssue Number : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + '\n Issue closed by : ' + req.body.issue.user.login + '\nIn repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '.';
                    } else if (req.body.action === 'reopened') {
                        FinalMessage += 'reopened in repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Issue Re-opened by : ' + req.body.issue.user.login + '\nIssue Details:\nIssue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + '\n The Issue can be found here : ' + req.body.issue.html_url + '.';
                    } else if (req.body.action === 'labeled') {
                        FinalMessage == 'Issue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + ' has been updated with the following labels: ';
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += 'In repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Label added by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + ' .';
                    } else if (req.body.action === 'unlabeled') {
                        FinalMessage == 'The following labels : ';
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += '\n Have been removed from Issue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title;
                        FinalMessage += 'In repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Label added by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + ' .';
                    } else {
                        FinalMessage += req.body.action + ' action not coded yet...coming soon';
                    }
                } else {
                    log('Event type: ' + req.get('X-Github-Event'));
                    FinalMessage = 'Event type : ' + req.get('X-Github-Event') + ' in board. (NOT coded yet...Coming soon)';
                }
            log(FinalMessage);
            return FinalMessage;
        });
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pc3N1ZV9ldmVudHMuanMiXSwibmFtZXMiOlsiXyIsInJlcXVpcmUiLCJycCIsIlJlZ2V4IiwiZGF0ZUZvcm1hdCIsImxvZyIsIm1vZHVsZSIsImV4cG9ydHMiLCJwYXJzZVJlc3BvbnNlIiwicmVxIiwicmVzIiwiVXJsT3B0aW9ucyIsInVyaSIsInFzIiwiaGVhZGVycyIsImpzb24iLCJ0aGVuIiwiRmluYWxNZXNzYWdlIiwiZ2V0IiwiYm9keSIsImFjdGlvbiIsImlzc3VlIiwibnVtYmVyIiwicmVwb3NpdG9yeSIsIm5hbWUiLCJpZCIsImNvbW1lbnQiLCJ1c2VyIiwibG9naW4iLCJodG1sX3VybCIsInRpdGxlIiwiaSIsImxhYmVscyIsImxlbmd0aCJdLCJtYXBwaW5ncyI6Ijs7QUFNQTs7Ozs7O0FBTkEsSUFBSUEsSUFBSUMsUUFBUSxRQUFSLENBQVI7QUFDQSxJQUFJQyxLQUFLRCxRQUFRLGlCQUFSLENBQVQ7QUFDQSxJQUFJRSxRQUFRRixRQUFRLE9BQVIsQ0FBWjtBQUNBLElBQUlHLGFBQWFILFFBQVEsWUFBUixDQUFqQjs7QUFFQTs7QUFFQSxJQUFNSSxNQUFNLDZDQUFNLHFCQUFOLENBQVo7O0FBRUFDLE9BQU9DLE9BQVAsR0FBaUI7O0FBRWJDLG1CQUFnQiwrQ0FBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CO0FBQ2hDTCxZQUFJLGVBQUo7QUFDQTtBQUNBOztBQUVBLFlBQUlNLGFBQWE7QUFDYkMsaUJBQUsseUJBRFE7QUFFYkMsZ0JBQUksRUFGUztBQUliQyxxQkFBUztBQUNMLDhCQUFjO0FBRFQsYUFKSTtBQU9iQyxrQkFBTSxJQVBPLENBT0Y7QUFQRSxTQUFqQjs7QUFVQSxlQUFPYixHQUFHUyxVQUFILEVBQWVLLElBQWYsQ0FBb0IsWUFBWTs7QUFFbkMsZ0JBQUlDLGVBQWUsRUFBbkI7O0FBRUE7QUFDQSxnQkFBSVIsSUFBSVMsR0FBSixDQUFRLGdCQUFSLE1BQThCLGVBQWxDLEVBQW1EO0FBQy9DYixvQkFBSSxhQUFhSSxJ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VyxNQUFmLENBQXNCQyxNQUExQyxFQUFrREYsR0FBbEQsRUFBdUQ7QUFDbkRkLDRDQUFnQixTQUFTUixJQUFJVSxJQUFKLENBQVNFLEtBQVQsQ0FBZVcsTUFBZixDQUFzQkQsQ0FBdEIsRUFBeUJQLElBQWxDLEdBQXlDLElBQXpEO0FBQ0g7QUFDRFAsd0NBQWdCLDJDQUEyQ1IsSUFBSVUsSUFBSixDQUFTRSxLQUFULENBQWVDLE1BQTFELEdBQW1FLGlCQUFuRSxHQUF1RmIsSUFBSVUsSUFBSixDQUFTRSxLQUFULENBQWVTLEtBQXRIO0FBQ0FiLHdDQUFnQixtQkFBbUJSLElBQUlVLElBQUosQ0FBU0ksVUFBVCxDQUFvQkMsSUFBdkMsR0FBOEMsaUJBQTlDLEdBQWtFZixJQUFJVSxJQUFKLENBQVNJLFVBQVQsQ0FBb0JFLEVBQXRGLEdBQTJGLHNCQUEzRixHQUFvSGhCLElBQUlVLElBQUosQ0FBU0UsS0FBVCxDQUFlTSxJQUFmLENBQW9CQyxLQUF4SSxHQUFnSixtQ0FBaEosR0FBc0xuQixJQUFJVSxJQUFKLENBQVNFLEtBQVQsQ0FBZVEsUUFBck0sR0FBZ04sSUFBaE87QUFDSCxxQkFQTSxNQVFGO0FBQ0RaLHdDQUFnQlIsSUFBSVUsSUFBSixDQUFTQyxNQUFULEdBQWtCLHFDQUFsQztBQUNIO0FBQ0osaUJBakNJLE1Ba0NBO0FBQ0RmLHdCQUFJLGlCQUFpQkksSUFBSVMsR0FBSixDQUFRLGdCQUFSLENBQXJCO0FBQ0FELG1DQUFlLGtCQUFnQlIsSUFBSVMsR0FBSixDQUFRLGdCQUFSLENBQWhCLEdBQTBDLDBDQUF6RDtBQUNIO0FBQ0RiLGdCQUFJWSxZQUFKO0FBQ0EsbUJBQU9BLFlBQVA7QUFDSCxTQWhFTSxDQUFQO0FBaUVIO0FBbEZZLENBQWpCIiwiZmlsZSI6Imlzc3VlX2V2ZW50cy5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG52YXIgcnAgPSByZXF1aXJlKCdyZXF1ZXN0LXByb21pc2UnKTtcbnZhciBSZWdleCA9IHJlcXVpcmUoJ3JlZ2V4Jyk7XG52YXIgZGF0ZUZvcm1hdCA9IHJlcXVpcmUoJ2RhdGVmb3JtYXQnKTtcblxuLy8gU2V0dXAgZGVidWcgbG9nXG5pbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnO1xuY29uc3QgbG9nID0gZGVidWcoJ3dhdHNvbndvcmstc2NydW1ib3QnKTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgICBwYXJzZVJlc3BvbnNlOiAoZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gICAgICAgIGxvZygncGFyc2VyZXNwb25zZScpXG4gICAgICAgIC8vdmFyIHJlcSA9IG9wdGlvbnMucmVxdWVzdDtcbiAgICAgICAgLy92YXIgcmVzID0gb3B0aW9ucy5yZXNwb25zZTtcblxuICAgICAgICB2YXIgVXJsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHVyaTogJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vJyxcbiAgICAgICAgICAgIHFzOiB7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ1JlcXVlc3QtUHJvbWlzZSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqc29uOiB0cnVlIC8vIEF1dG9tYXRpY2FsbHkgcGFyc2VzIHRoZSBKU09OIHN0cmluZyBpbiB0aGUgcmVzcG9uc2VcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gcnAoVXJsT3B0aW9ucykudGhlbihmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciBGaW5hbE1lc3NhZ2UgPSAnJztcblxuICAgICAgICAgICAgLy9DT01NRU5UU1xuICAgICAgICAgICAgaWYgKHJlcS5nZXQoJ1gtR2l0aHViLUV2ZW50JykgPT09ICdpc3N1ZV9jb21tZW50Jykge1xuICAgICAgICAgICAgICAgIGxvZygnYWN0aW9uOiAnICsgcmVxLmJvZHkuYWN0aW9uKVxuXG4gICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID0gJ0EgQ29tbWVudCBoYXMganVzdCBiZWVuICdcblxuICAgICAgICAgICAgICAgIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdjcmVhdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ2FkZGVkIHRvIGlzc3VlICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJyBpbiByZXBvc2l0b3J5ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5Lm5hbWUgKyAnIHdpdGggSUQgOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICcgYnkgdXNlciAnICsgcmVxLmJvZHkuY29tbWVudC51c2VyLmxvZ2luICsgJ1xcbiBUaGUgY29tbWVudCBjYW4gYmUgZm91bmQgaGVyZSA6ICcgKyByZXEuYm9keS5jb21tZW50Lmh0bWxfdXJsICsgJy4gXFxuIFRoZSBjb250ZW50IG9mIHRoZSBjb21tZW50IGlzIDogXFxuJyArIHJlcS5ib2R5LmNvbW1lbnQuYm9keTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnZWRpdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ2VkaXRlZCB1bmRlciBpc3N1ZSAjJyArIHJlcS5ib2R5Lmlzc3VlLm51bWJlciArICcgaW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIElEIDogJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkuaWQgKyAnIGJ5IHVzZXIgJyArIHJlcS5ib2R5LmNvbW1lbnQudXNlci5sb2dpbiArICdcXG4gVGhlIGNvbW1lbnQgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuY29tbWVudC5odG1sX3VybCArICcuIFxcbiBUaGUgY29udGVudCBvZiB0aGUgY29tbWVudCBpcyA6IFxcbicgKyByZXEuYm9keS5jb21tZW50LmJvZHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcS5ib2R5LmFjdGlvbiA9PT0gJ2RlbGV0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdDb21tZW50IGNvbnRlbnQgOiBfXCInICsgcmVxLmJvZHkuY29tbWVudC5ib2R5ICsgJ1wiX1xcblRoZSBhYm92ZSBjb21tZW50IHdhcyBkZWxldGVkIHVuZGVyIGlzc3VlICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJyBieSB1c2VyICcgKyByZXEuYm9keS5jb21tZW50LnVzZXIubG9naW4gKyAnIGluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCBJRCA6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9IHJlcS5ib2R5LmFjdGlvbiArICcgYWN0aW9uIG5vdCBjb2RlZCB5ZXQuLi5jb21pbmcgc29vbidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL0lTU1VFU1xuICAgICAgICAgICAgZWxzZSBpZiAocmVxLmdldCgnWC1HaXRodWItRXZlbnQnKSA9PT0gJ2lzc3VlcycpIHtcbiAgICAgICAgICAgICAgICBsb2coJ2FjdGlvbjogJyArIHJlcS5ib2R5LmFjdGlvbilcblxuICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdBbiBpc3N1ZSBoYXMganVzdCBiZWVuICdcblxuICAgICAgICAgICAgICAgIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdvcGVuZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnb3BlbmVkIGluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCByZXBvIGlkOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICdcXG5Jc3N1ZSBEZXRhaWxzOlxcbklzc3VlIElEIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXEuYm9keS5pc3N1ZS5sYWJlbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuVGhlIGZvbGxvd2luZyBsYWJlbHMgd2VyZSBhZGRlZDogJ1xuICAgICAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9ICdcXG5cXHQnICsgcmVxLmJvZHkuaXNzdWUubGFiZWxzW2ldLm5hbWUgKyAnXFxuJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuIElzc3VlIG9wZW5lZCBieSA6ICcgKyByZXEuYm9keS5pc3N1ZS51c2VyLmxvZ2luICsgJ1xcbiBUaGUgSXNzdWUgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuaXNzdWUuaHRtbF91cmwgKyAnLic7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdjbG9zZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnY2xvc2VkLiAnICsgJ1xcbklzc3VlIERldGFpbHM6XFxuSXNzdWUgTnVtYmVyIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZSArICdcXG4gSXNzdWUgY2xvc2VkIGJ5IDogJyArIHJlcS5ib2R5Lmlzc3VlLnVzZXIubG9naW4gKyAnXFxuSW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJy4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAncmVvcGVuZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAncmVvcGVuZWQgaW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJ1xcbiBJc3N1ZSBSZS1vcGVuZWQgYnkgOiAnICsgcmVxLmJvZHkuaXNzdWUudXNlci5sb2dpbiArICdcXG5Jc3N1ZSBEZXRhaWxzOlxcbklzc3VlIElEIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZSArICdcXG4gVGhlIElzc3VlIGNhbiBiZSBmb3VuZCBoZXJlIDogJyArIHJlcS5ib2R5Lmlzc3VlLmh0bWxfdXJsICsgJy4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnbGFiZWxlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID09ICdJc3N1ZSBJRCA6ICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJ1xcbklzc3VlIFRpdGxlOiAnICsgcmVxLmJvZHkuaXNzdWUudGl0bGUgKyAnIGhhcyBiZWVuIHVwZGF0ZWQgd2l0aCB0aGUgZm9sbG93aW5nIGxhYmVsczogJztcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXEuYm9keS5pc3N1ZS5sYWJlbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuXFx0JyArIHJlcS5ib2R5Lmlzc3VlLmxhYmVsc1tpXS5uYW1lICsgJ1xcbidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ0luIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCByZXBvIGlkOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICdcXG4gTGFiZWwgYWRkZWQgYnkgOiAnICsgcmVxLmJvZHkuaXNzdWUudXNlci5sb2dpbiArICdcXG4gVGhlIElzc3VlIGNhbiBiZSBmb3VuZCBoZXJlIDogJyArIHJlcS5ib2R5Lmlzc3VlLmh0bWxfdXJsICsgJyAuJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcS5ib2R5LmFjdGlvbiA9PT0gJ3VubGFiZWxlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID09ICdUaGUgZm9sbG93aW5nIGxhYmVscyA6ICc7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVxLmJvZHkuaXNzdWUubGFiZWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ1xcblxcdCcgKyByZXEuYm9keS5pc3N1ZS5sYWJlbHNbaV0ubmFtZSArICdcXG4nXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9ICdcXG4gSGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSBJc3N1ZSBJRCA6ICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJ1xcbklzc3VlIFRpdGxlOiAnICsgcmVxLmJvZHkuaXNzdWUudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnSW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJ1xcbiBMYWJlbCBhZGRlZCBieSA6ICcgKyByZXEuYm9keS5pc3N1ZS51c2VyLmxvZ2luICsgJ1xcbiBUaGUgSXNzdWUgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuaXNzdWUuaHRtbF91cmwgKyAnIC4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9IHJlcS5ib2R5LmFjdGlvbiArICcgYWN0aW9uIG5vdCBjb2RlZCB5ZXQuLi5jb21pbmcgc29vbidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBsb2coJ0V2ZW50IHR5cGU6ICcgKyByZXEuZ2V0KCdYLUdpdGh1Yi1FdmVudCcpKVxuICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdFdmVudCB0eXBlIDogJytyZXEuZ2V0KCdYLUdpdGh1Yi1FdmVudCcpKycgaW4gYm9hcmQuIChOT1QgY29kZWQgeWV0Li4uQ29taW5nIHNvb24pJ1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nKEZpbmFsTWVzc2FnZSlcbiAgICAgICAgICAgIHJldHVybiBGaW5hbE1lc3NhZ2U7XG4gICAgICAgIH0pO1xuICAgIH0pXG59O1xuIl19