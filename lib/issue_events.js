/*istanbul ignore next*/'use strict';

var /*istanbul ignore next*/_debug = require('debug');

/*istanbul ignore next*/var _debug2 = _interopRequireDefault(_debug);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _ = require('lodash');
var rp = require('request-promise');
var Regex = require('regex');
var dateFormat = require('dateformat');

// Setup debug log

var log = /*istanbul ignore next*/(0, _debug2.default)('watsonwork-scrumbot');

module.exports = {

    parseResponse: function /*istanbul ignore next*/parseResponse(req, res) {
        log('parseresponse');
        //var req = options.request;
        //var res = options.response;

        var UrlOptions = {
            uri: 'https://api.github.com/',
            qs: {},
            headers: {
                'User-Agent': 'Request-Promise'
            },
            json: true // Automatically parses the JSON string in the response
        };

        return rp(UrlOptions).then(function () {

            var FinalMessage = '';

            //COMMENTS
            if (req.get('X-Github-Event') === 'issue_comment') {
                log('action: ' + req.body.action);

                FinalMessage = 'A Comment has just been ';

                if (req.body.action === 'created') {
                    FinalMessage += 'added to issue #' + req.body.issue.number + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id + ' by user ' + req.body.comment.user.login + '\n The comment can be found here : ' + req.body.comment.html_url + '. \n The content of the comment is : \n' + req.body.comment.body;
                } else if (req.body.action === 'edited') {
                    FinalMessage += 'edited under issue #' + req.body.issue.number + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id + ' by user ' + req.body.comment.user.login + '\n The comment can be found here : ' + req.body.comment.html_url + '. \n The content of the comment is : \n' + req.body.comment.body;
                } else if (req.body.action === 'deleted') {
                    FinalMessage = 'Comment content : _"' + req.body.comment.body + '"_\nThe above comment was deleted under issue #' + req.body.issue.number + ' by user ' + req.body.comment.user.login + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id;
                } else {
                    FinalMessage += req.body.action + ' action not coded yet...coming soon';
                }
            }
            //ISSUES
            else if (req.get('X-Github-Event') === 'issues') {
                    log('action: ' + req.body.action);

                    FinalMessage = 'An issue has just been ';

                    if (req.body.action === 'opened') {
                        FinalMessage += 'opened in repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\nIssue Details:\nIssue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title;
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\nThe following labels were added: ';
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += '\n Issue opened by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + '.';
                    } else if (req.body.action === 'closed') {
                        FinalMessage += 'closed. ' + '\nIssue Details:\nIssue Number : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + '\n Issue closed by : ' + req.body.issue.user.login + '\nIn repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '.';
                    } else if (req.body.action === 'reopened') {
                        FinalMessage += 'reopened in repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Issue Re-opened by : ' + req.body.issue.user.login + '\nIssue Details:\nIssue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + '\n The Issue can be found here : ' + req.body.issue.html_url + '.';
                    } else if (req.body.action === 'labeled') {
                        FinalMessage = 'Issue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + ' has been updated with the following labels: ';
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += 'In repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Label added by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + ' .';
                    } else if (req.body.action === 'unlabeled') {
                        FinalMessage = 'The following label : \n\t' + req.body.label.name;

                        FinalMessage += '\n Has been removed from Issue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title;
                        FinalMessage += 'In repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Label removed by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + ' .';
                    } else {
                        FinalMessage = req.body.action + ' action not coded yet...coming soon';
                    }
                } else {
                    log('Event type: ' + req.get('X-Github-Event'));
                    FinalMessage = 'Event type : ' + req.get('X-Github-Event') + ' in board. (NOT coded yet...Coming soon)';
                }
            log(FinalMessage);
            return FinalMessage;
        });
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pc3N1ZV9ldmVudHMuanMiXSwibmFtZXMiOlsiXyIsInJlcXVpcmUiLCJycCIsIlJlZ2V4IiwiZGF0ZUZvcm1hdCIsImxvZyIsIm1vZHVsZSIsImV4cG9ydHMiLCJwYXJzZVJlc3BvbnNlIiwicmVxIiwicmVzIiwiVXJsT3B0aW9ucyIsInVyaSIsInFzIiwiaGVhZGVycyIsImpzb24iLCJ0aGVuIiwiRmluYWxNZXNzYWdlIiwiZ2V0IiwiYm9keSIsImFjdGlvbiIsImlzc3VlIiwibnVtYmVyIiwicmVwb3NpdG9yeSIsIm5hbWUiLCJpZCIsImNvbW1lbnQiLCJ1c2VyIiwibG9naW4iLCJodG1sX3VybCIsInRpdGxlIiwiaSIsImxhYmVscyIsImxlbmd0aCIsImxhYmVsIl0sIm1hcHBpbmdzIjoiOztBQU1BOzs7Ozs7QUFOQSxJQUFJQSxJQUFJQyxRQUFRLFFBQVIsQ0FBUjtBQUNBLElBQUlDLEtBQUtELFFBQVEsaUJBQVIsQ0FBVDtBQUNBLElBQUlFLFFBQVFGLFFBQVEsT0FBUixDQUFaO0FBQ0EsSUFBSUcsYUFBYUgsUUFBUSxZQUFSLENBQWpCOztBQUVBOztBQUVBLElBQU1JLE1BQU0sNkNBQU0scUJBQU4sQ0FBWjs7QUFFQUMsT0FBT0MsT0FBUCxHQUFpQjs7QUFFYkMsbUJBQWdCLCtDQUFVQyxHQUFWLEVBQWVDLEdBQWYsRUFBb0I7QUFDaENMLFlBQUksZUFBSjtBQUNBO0FBQ0E7O0FBRUEsWUFBSU0sYUFBYTtBQUNiQyxpQkFBSyx5QkFEUTtBQUViQyxnQkFBSSxFQUZTO0FBSWJDLHFCQUFTO0FBQ0wsOEJBQWM7QUFEVCxhQUpJO0FBT2JDLGtCQUFNLElBUE8sQ0FPRjtBQVBFLFNBQWpCOztBQVVBLGVBQU9iLEdBQUdTLFVBQUgsRUFBZUssSUFBZixDQUFvQixZQUFZOztBQUVuQyxnQkFBSUMsZUFBZSxFQUFuQjs7QUFFQTtBQUNBLGdCQUFJUixJQUFJUyxHQUFKLENBQVEsZ0JBQVIsTUFBOEIsZUFBbEMsRUFBbUQ7QUFDL0NiLG9CQUFJ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VSxJQUFKLENBQVNFLEtBQVQsQ0FBZUMsTUFBekQsR0FBa0UsaUJBQWxFLEdBQXNGYixJQUFJVSxJQUFKLENBQVNFLEtBQVQsQ0FBZVMsS0FBckg7QUFDQWIsd0NBQWdCLG1CQUFtQlIsSUFBSVUsSUFBSixDQUFTSSxVQUFULENBQW9CQyxJQUF2QyxHQUE4QyxpQkFBOUMsR0FBa0VmLElBQUlVLElBQUosQ0FBU0ksVUFBVCxDQUFvQkUsRUFBdEYsR0FBMkYsd0JBQTNGLEdBQXNIaEIsSUFBSVUsSUFBSixDQUFTRSxLQUFULENBQWVNLElBQWYsQ0FBb0JDLEtBQTFJLEdBQWtKLG1DQUFsSixHQUF3TG5CLElBQUlVLElBQUosQ0FBU0UsS0FBVCxDQUFlUSxRQUF2TSxHQUFrTixJQUFsTztBQUNILHFCQUxNLE1BTUY7QUFDRFosdUNBQWVSLElBQUlVLElBQUosQ0FBU0MsTUFBVCxHQUFrQixxQ0FBakM7QUFDSDtBQUNKLGlCQS9CSSxNQWdDQTtBQUNEZix3QkFBSSxpQkFBaUJJLElBQUlTLEdBQUosQ0FBUSxnQkFBUixDQUFyQjtBQUNBRCxtQ0FBZSxrQkFBZ0JSLElBQUlTLEdBQUosQ0FBUSxnQkFBUixDQUFoQixHQUEwQywwQ0FBekQ7QUFDSDtBQUNEYixnQkFBSVksWUFBSjtBQUNBLG1CQUFPQSxZQUFQO0FBQ0gsU0E5RE0sQ0FBUDtBQStESDtBQWhGWSxDQUFqQiIsImZpbGUiOiJpc3N1ZV9ldmVudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xudmFyIHJwID0gcmVxdWlyZSgncmVxdWVzdC1wcm9taXNlJyk7XG52YXIgUmVnZXggPSByZXF1aXJlKCdyZWdleCcpO1xudmFyIGRhdGVGb3JtYXQgPSByZXF1aXJlKCdkYXRlZm9ybWF0Jyk7XG5cbi8vIFNldHVwIGRlYnVnIGxvZ1xuaW1wb3J0IGRlYnVnIGZyb20gJ2RlYnVnJztcbmNvbnN0IGxvZyA9IGRlYnVnKCd3YXRzb253b3JrLXNjcnVtYm90Jyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgcGFyc2VSZXNwb25zZTogKGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAgICAgICBsb2coJ3BhcnNlcmVzcG9uc2UnKVxuICAgICAgICAvL3ZhciByZXEgPSBvcHRpb25zLnJlcXVlc3Q7XG4gICAgICAgIC8vdmFyIHJlcyA9IG9wdGlvbnMucmVzcG9uc2U7XG5cbiAgICAgICAgdmFyIFVybE9wdGlvbnMgPSB7XG4gICAgICAgICAgICB1cmk6ICdodHRwczovL2FwaS5naXRodWIuY29tLycsXG4gICAgICAgICAgICBxczoge1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdSZXF1ZXN0LVByb21pc2UnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAganNvbjogdHJ1ZSAvLyBBdXRvbWF0aWNhbGx5IHBhcnNlcyB0aGUgSlNPTiBzdHJpbmcgaW4gdGhlIHJlc3BvbnNlXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHJwKFVybE9wdGlvbnMpLnRoZW4oZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgRmluYWxNZXNzYWdlID0gJyc7XG5cbiAgICAgICAgICAgIC8vQ09NTUVOVFNcbiAgICAgICAgICAgIGlmIChyZXEuZ2V0KCdYLUdpdGh1Yi1FdmVudCcpID09PSAnaXNzdWVfY29tbWVudCcpIHtcbiAgICAgICAgICAgICAgICBsb2coJ2FjdGlvbjogJyArIHJlcS5ib2R5LmFjdGlvbilcblxuICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdBIENvbW1lbnQgaGFzIGp1c3QgYmVlbiAnXG5cbiAgICAgICAgICAgICAgICBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnY3JlYXRlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9ICdhZGRlZCB0byBpc3N1ZSAjJyArIHJlcS5ib2R5Lmlzc3VlLm51bWJlciArICcgaW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIElEIDogJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkuaWQgKyAnIGJ5IHVzZXIgJyArIHJlcS5ib2R5LmNvbW1lbnQudXNlci5sb2dpbiArICdcXG4gVGhlIGNvbW1lbnQgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuY29tbWVudC5odG1sX3VybCArICcuIFxcbiBUaGUgY29udGVudCBvZiB0aGUgY29tbWVudCBpcyA6IFxcbicgKyByZXEuYm9keS5jb21tZW50LmJvZHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcS5ib2R5LmFjdGlvbiA9PT0gJ2VkaXRlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9ICdlZGl0ZWQgdW5kZXIgaXNzdWUgIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnIGluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCBJRCA6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJyBieSB1c2VyICcgKyByZXEuYm9keS5jb21tZW50LnVzZXIubG9naW4gKyAnXFxuIFRoZSBjb21tZW50IGNhbiBiZSBmb3VuZCBoZXJlIDogJyArIHJlcS5ib2R5LmNvbW1lbnQuaHRtbF91cmwgKyAnLiBcXG4gVGhlIGNvbnRlbnQgb2YgdGhlIGNvbW1lbnQgaXMgOiBcXG4nICsgcmVxLmJvZHkuY29tbWVudC5ib2R5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdkZWxldGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgPSAnQ29tbWVudCBjb250ZW50IDogX1wiJyArIHJlcS5ib2R5LmNvbW1lbnQuYm9keSArICdcIl9cXG5UaGUgYWJvdmUgY29tbWVudCB3YXMgZGVsZXRlZCB1bmRlciBpc3N1ZSAjJyArIHJlcS5ib2R5Lmlzc3VlLm51bWJlciArICcgYnkgdXNlciAnICsgcmVxLmJvZHkuY29tbWVudC51c2VyLmxvZ2luICsgJyBpbiByZXBvc2l0b3J5ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5Lm5hbWUgKyAnIHdpdGggSUQgOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSByZXEuYm9keS5hY3Rpb24gKyAnIGFjdGlvbiBub3QgY29kZWQgeWV0Li4uY29taW5nIHNvb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9JU1NVRVNcbiAgICAgICAgICAgIGVsc2UgaWYgKHJlcS5nZXQoJ1gtR2l0aHViLUV2ZW50JykgPT09ICdpc3N1ZXMnKSB7XG4gICAgICAgICAgICAgICAgbG9nKCdhY3Rpb246ICcgKyByZXEuYm9keS5hY3Rpb24pXG5cbiAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgPSAnQW4gaXNzdWUgaGFzIGp1c3QgYmVlbiAnXG5cbiAgICAgICAgICAgICAgICBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnb3BlbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ29wZW5lZCBpbiByZXBvc2l0b3J5ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5Lm5hbWUgKyAnIHdpdGggcmVwbyBpZDogJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkuaWQgKyAnXFxuSXNzdWUgRGV0YWlsczpcXG5Jc3N1ZSBJRCA6ICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJ1xcbklzc3VlIFRpdGxlOiAnICsgcmVxLmJvZHkuaXNzdWUudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVxLmJvZHkuaXNzdWUubGFiZWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ1xcblRoZSBmb2xsb3dpbmcgbGFiZWxzIHdlcmUgYWRkZWQ6ICdcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuXFx0JyArIHJlcS5ib2R5Lmlzc3VlLmxhYmVsc1tpXS5uYW1lICsgJ1xcbidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ1xcbiBJc3N1ZSBvcGVuZWQgYnkgOiAnICsgcmVxLmJvZHkuaXNzdWUudXNlci5sb2dpbiArICdcXG4gVGhlIElzc3VlIGNhbiBiZSBmb3VuZCBoZXJlIDogJyArIHJlcS5ib2R5Lmlzc3VlLmh0bWxfdXJsICsgJy4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnY2xvc2VkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ2Nsb3NlZC4gJyArICdcXG5Jc3N1ZSBEZXRhaWxzOlxcbklzc3VlIE51bWJlciA6ICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJ1xcbklzc3VlIFRpdGxlOiAnICsgcmVxLmJvZHkuaXNzdWUudGl0bGUgKyAnXFxuIElzc3VlIGNsb3NlZCBieSA6ICcgKyByZXEuYm9keS5pc3N1ZS51c2VyLmxvZ2luICsgJ1xcbkluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCByZXBvIGlkOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICcuJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcS5ib2R5LmFjdGlvbiA9PT0gJ3Jlb3BlbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ3Jlb3BlbmVkIGluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCByZXBvIGlkOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICdcXG4gSXNzdWUgUmUtb3BlbmVkIGJ5IDogJyArIHJlcS5ib2R5Lmlzc3VlLnVzZXIubG9naW4gKyAnXFxuSXNzdWUgRGV0YWlsczpcXG5Jc3N1ZSBJRCA6ICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJ1xcbklzc3VlIFRpdGxlOiAnICsgcmVxLmJvZHkuaXNzdWUudGl0bGUgKyAnXFxuIFRoZSBJc3N1ZSBjYW4gYmUgZm91bmQgaGVyZSA6ICcgKyByZXEuYm9keS5pc3N1ZS5odG1sX3VybCArICcuJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcS5ib2R5LmFjdGlvbiA9PT0gJ2xhYmVsZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdJc3N1ZSBJRCA6ICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJ1xcbklzc3VlIFRpdGxlOiAnICsgcmVxLmJvZHkuaXNzdWUudGl0bGUgKyAnIGhhcyBiZWVuIHVwZGF0ZWQgd2l0aCB0aGUgZm9sbG93aW5nIGxhYmVsczogJztcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXEuYm9keS5pc3N1ZS5sYWJlbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuXFx0JyArIHJlcS5ib2R5Lmlzc3VlLmxhYmVsc1tpXS5uYW1lICsgJ1xcbidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ0luIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCByZXBvIGlkOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICdcXG4gTGFiZWwgYWRkZWQgYnkgOiAnICsgcmVxLmJvZHkuaXNzdWUudXNlci5sb2dpbiArICdcXG4gVGhlIElzc3VlIGNhbiBiZSBmb3VuZCBoZXJlIDogJyArIHJlcS5ib2R5Lmlzc3VlLmh0bWxfdXJsICsgJyAuJztcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcS5ib2R5LmFjdGlvbiA9PT0gJ3VubGFiZWxlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID0gJ1RoZSBmb2xsb3dpbmcgbGFiZWwgOiBcXG5cXHQnK3JlcS5ib2R5LmxhYmVsLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ1xcbiBIYXMgYmVlbiByZW1vdmVkIGZyb20gSXNzdWUgSUQgOiAjJyArIHJlcS5ib2R5Lmlzc3VlLm51bWJlciArICdcXG5Jc3N1ZSBUaXRsZTogJyArIHJlcS5ib2R5Lmlzc3VlLnRpdGxlO1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ0luIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCByZXBvIGlkOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICdcXG4gTGFiZWwgcmVtb3ZlZCBieSA6ICcgKyByZXEuYm9keS5pc3N1ZS51c2VyLmxvZ2luICsgJ1xcbiBUaGUgSXNzdWUgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuaXNzdWUuaHRtbF91cmwgKyAnIC4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID0gcmVxLmJvZHkuYWN0aW9uICsgJyBhY3Rpb24gbm90IGNvZGVkIHlldC4uLmNvbWluZyBzb29uJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvZygnRXZlbnQgdHlwZTogJyArIHJlcS5nZXQoJ1gtR2l0aHViLUV2ZW50JykpXG4gICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID0gJ0V2ZW50IHR5cGUgOiAnK3JlcS5nZXQoJ1gtR2l0aHViLUV2ZW50JykrJyBpbiBib2FyZC4gKE5PVCBjb2RlZCB5ZXQuLi5Db21pbmcgc29vbiknXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2coRmluYWxNZXNzYWdlKVxuICAgICAgICAgICAgcmV0dXJuIEZpbmFsTWVzc2FnZTtcbiAgICAgICAgfSk7XG4gICAgfSlcbn07XG4iXX0=