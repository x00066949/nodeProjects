/*istanbul ignore next*/'use strict';

var /*istanbul ignore next*/_debug = require('debug');

/*istanbul ignore next*/var _debug2 = _interopRequireDefault(_debug);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _ = require('lodash');
var rp = require('request-promise');
var Regex = require('regex');
var dateFormat = require('dateformat');

// Setup debug log

var log = /*istanbul ignore next*/(0, _debug2.default)('watsonwork-scrumbot');

module.exports = {

    parseResponse: function /*istanbul ignore next*/parseResponse(req, res) {
        log('parseresponse');

        var UrlOptions = {
            uri: 'https://api.github.com/',
            qs: {},
            headers: {
                'User-Agent': 'Request-Promise'
            },
            json: true // Automatically parses the JSON string in the response
        };

        return rp(UrlOptions).then(function () {

            var FinalMessage = '';

            //COMMENTS
            if (req.get('X-Github-Event') === 'issue_comment') {
                log('action: ' + req.body.action);

                FinalMessage = 'A Comment has just been ';

                if (req.body.action === 'created') {
                    FinalMessage += 'added to issue #' + req.body.issue.number + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id + ' by user ' + req.body.comment.user.login + '\n The comment can be found here : ' + req.body.comment.html_url + '. \n The content of the comment is : \n' + req.body.comment.body;
                } else if (req.body.action === 'edited') {
                    FinalMessage += 'edited under issue #' + req.body.issue.number + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id + ' by user ' + req.body.comment.user.login + '\n The comment can be found here : ' + req.body.comment.html_url + '. \n The content of the comment is : \n' + req.body.comment.body;
                } else if (req.body.action === 'deleted') {
                    FinalMessage = 'Comment content : _"' + req.body.comment.body + '"_\nThe above comment was deleted under issue #' + req.body.issue.number + ' by user ' + req.body.comment.user.login + ' in repository ' + req.body.repository.name + ' with ID : ' + req.body.repository.id;
                } else {
                    FinalMessage += req.body.action + ' action not coded yet...coming soon';
                }
            }
            //ISSUES
            else if (req.get('X-Github-Event') === 'issues') {
                    log('action: ' + req.body.action);

                    FinalMessage = 'An issue has just been ';

                    if (req.body.action === 'opened') {
                        FinalMessage += 'opened in repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\nIssue Details:\nIssue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title;
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\nThe following labels were added: ';
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += '\n Issue opened by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + '.';
                    } else if (req.body.action === 'closed') {
                        FinalMessage += 'closed. ' + '\nIssue Details:\nIssue Number : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + '\n Issue closed by : ' + req.body.issue.user.login + '\nIn repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '.';
                    } else if (req.body.action === 'reopened') {
                        FinalMessage += 'reopened in repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Issue Re-opened by : ' + req.body.issue.user.login + '\nIssue Details:\nIssue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + '\n The Issue can be found here : ' + req.body.issue.html_url + '.';
                    } else if (req.body.action === 'labeled') {
                        FinalMessage = 'Issue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title + ' has been updated with the following labels: ';
                        for (var i = 0; i < req.body.issue.labels.length; i++) {
                            FinalMessage += '\n\t' + req.body.issue.labels[i].name + '\n';
                        }
                        FinalMessage += 'In repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Label added by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + ' .';
                    } else if (req.body.action === 'unlabeled') {
                        FinalMessage = 'The following label : \n\t' + req.body.label.name;

                        FinalMessage += '\n Has been removed from Issue ID : #' + req.body.issue.number + '\nIssue Title: ' + req.body.issue.title;
                        FinalMessage += 'In repository ' + req.body.repository.name + ' with repo id: ' + req.body.repository.id + '\n Label removed by : ' + req.body.issue.user.login + '\n The Issue can be found here : ' + req.body.issue.html_url + ' .';
                    } else {
                        FinalMessage = req.body.action + ' action not coded yet...coming soon';
                    }
                } else {
                    log('Event type: ' + req.get('X-Github-Event'));
                    FinalMessage = 'Event type : ' + req.get('X-Github-Event') + ' in board. (NOT coded yet...Coming soon)';
                }
            log(FinalMessage);
            return FinalMessage;
        });
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pc3N1ZV9ldmVudHMuanMiXSwibmFtZXMiOlsiXyIsInJlcXVpcmUiLCJycCIsIlJlZ2V4IiwiZGF0ZUZvcm1hdCIsImxvZyIsIm1vZHVsZSIsImV4cG9ydHMiLCJwYXJzZVJlc3BvbnNlIiwicmVxIiwicmVzIiwiVXJsT3B0aW9ucyIsInVyaSIsInFzIiwiaGVhZGVycyIsImpzb24iLCJ0aGVuIiwiRmluYWxNZXNzYWdlIiwiZ2V0IiwiYm9keSIsImFjdGlvbiIsImlzc3VlIiwibnVtYmVyIiwicmVwb3NpdG9yeSIsIm5hbWUiLCJpZCIsImNvbW1lbnQiLCJ1c2VyIiwibG9naW4iLCJodG1sX3VybCIsInRpdGxlIiwiaSIsImxhYmVscyIsImxlbmd0aCIsImxhYmVsIl0sIm1hcHBpbmdzIjoiOztBQU1BOzs7Ozs7QUFOQSxJQUFJQSxJQUFJQyxRQUFRLFFBQVIsQ0FBUjtBQUNBLElBQUlDLEtBQUtELFFBQVEsaUJBQVIsQ0FBVDtBQUNBLElBQUlFLFFBQVFGLFFBQVEsT0FBUixDQUFaO0FBQ0EsSUFBSUcsYUFBYUgsUUFBUSxZQUFSLENBQWpCOztBQUVBOztBQUVBLElBQU1JLE1BQU0sNkNBQU0scUJBQU4sQ0FBWjs7QUFFQUMsT0FBT0MsT0FBUCxHQUFpQjs7QUFFYkMsbUJBQWdCLCtDQUFVQyxHQUFWLEVBQWVDLEdBQWYsRUFBb0I7QUFDaENMLFlBQUksZUFBSjs7QUFFQSxZQUFJTSxhQUFhO0FBQ2JDLGlCQUFLLHlCQURRO0FBRWJDLGdCQUFJLEVBRlM7QUFJYkMscUJBQVM7QUFDTCw4QkFBYztBQURULGFBSkk7QUFPYkMsa0JBQU0sSUFQTyxDQU9GO0FBUEUsU0FBakI7O0FBVUEsZUFBT2IsR0FBR1MsVUFBSCxFQUFlSyxJQUFmLENBQW9CLFlBQVk7O0FBRW5DLGdCQUFJQyxlQUFlLEVBQW5COztBQUVBO0FBQ0EsZ0JBQUlSLElBQUlTLEdBQUosQ0FBUSxnQkFBUixNQUE4QixlQUFsQyxFQUFtRDtBQUMvQ2Isb0JBQUksYUFBYUksSUFB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U0UsS0FBVCxDQUFlQyxNQUF6RCxHQUFrRSxpQkFBbEUsR0FBc0ZiLElBQUlVLElBQUosQ0FBU0UsS0FBVCxDQUFlUyxLQUFySDtBQUNBYix3Q0FBZ0IsbUJBQW1CUixJQUFJVSxJQUFKLENBQVNJLFVBQVQsQ0FBb0JDLElBQXZDLEdBQThDLGlCQUE5QyxHQUFrRWYsSUFBSVUsSUFBSixDQUFTSSxVQUFULENBQW9CRSxFQUF0RixHQUEyRix3QkFBM0YsR0FBc0hoQixJQUFJVSxJQUFKLENBQVNFLEtBQVQsQ0FBZU0sSUFBZixDQUFvQkMsS0FBMUksR0FBa0osbUNBQWxKLEdBQXdMbkIsSUFBSVUsSUFBSixDQUFTRSxLQUFULENBQWVRLFFBQXZNLEdBQWtOLElBQWxPO0FBQ0gscUJBTE0sTUFNRjtBQUNEWix1Q0FBZVIsSUFBSVUsSUFBSixDQUFTQyxNQUFULEdBQWtCLHFDQUFqQztBQUNIO0FBQ0osaUJBL0JJLE1BZ0NBO0FBQ0RmLHdCQUFJLGlCQUFpQkksSUFBSVMsR0FBSixDQUFRLGdCQUFSLENBQXJCO0FBQ0FELG1DQUFlLGtCQUFrQlIsSUFBSVMsR0FBSixDQUFRLGdCQUFSLENBQWxCLEdBQThDLDBDQUE3RDtBQUNIO0FBQ0RiLGdCQUFJWSxZQUFKO0FBQ0EsbUJBQU9BLFlBQVA7QUFDSCxTQTlETSxDQUFQO0FBK0RIO0FBOUVZLENBQWpCIiwiZmlsZSI6Imlzc3VlX2V2ZW50cy5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG52YXIgcnAgPSByZXF1aXJlKCdyZXF1ZXN0LXByb21pc2UnKTtcbnZhciBSZWdleCA9IHJlcXVpcmUoJ3JlZ2V4Jyk7XG52YXIgZGF0ZUZvcm1hdCA9IHJlcXVpcmUoJ2RhdGVmb3JtYXQnKTtcblxuLy8gU2V0dXAgZGVidWcgbG9nXG5pbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnO1xuY29uc3QgbG9nID0gZGVidWcoJ3dhdHNvbndvcmstc2NydW1ib3QnKTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgICBwYXJzZVJlc3BvbnNlOiAoZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gICAgICAgIGxvZygncGFyc2VyZXNwb25zZScpXG4gICAgICAgIFxuICAgICAgICB2YXIgVXJsT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHVyaTogJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vJyxcbiAgICAgICAgICAgIHFzOiB7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ1JlcXVlc3QtUHJvbWlzZSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBqc29uOiB0cnVlIC8vIEF1dG9tYXRpY2FsbHkgcGFyc2VzIHRoZSBKU09OIHN0cmluZyBpbiB0aGUgcmVzcG9uc2VcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gcnAoVXJsT3B0aW9ucykudGhlbihmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciBGaW5hbE1lc3NhZ2UgPSAnJztcblxuICAgICAgICAgICAgLy9DT01NRU5UU1xuICAgICAgICAgICAgaWYgKHJlcS5nZXQoJ1gtR2l0aHViLUV2ZW50JykgPT09ICdpc3N1ZV9jb21tZW50Jykge1xuICAgICAgICAgICAgICAgIGxvZygnYWN0aW9uOiAnICsgcmVxLmJvZHkuYWN0aW9uKVxuXG4gICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID0gJ0EgQ29tbWVudCBoYXMganVzdCBiZWVuICdcblxuICAgICAgICAgICAgICAgIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdjcmVhdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ2FkZGVkIHRvIGlzc3VlICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJyBpbiByZXBvc2l0b3J5ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5Lm5hbWUgKyAnIHdpdGggSUQgOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICcgYnkgdXNlciAnICsgcmVxLmJvZHkuY29tbWVudC51c2VyLmxvZ2luICsgJ1xcbiBUaGUgY29tbWVudCBjYW4gYmUgZm91bmQgaGVyZSA6ICcgKyByZXEuYm9keS5jb21tZW50Lmh0bWxfdXJsICsgJy4gXFxuIFRoZSBjb250ZW50IG9mIHRoZSBjb21tZW50IGlzIDogXFxuJyArIHJlcS5ib2R5LmNvbW1lbnQuYm9keTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnZWRpdGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgKz0gJ2VkaXRlZCB1bmRlciBpc3N1ZSAjJyArIHJlcS5ib2R5Lmlzc3VlLm51bWJlciArICcgaW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIElEIDogJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkuaWQgKyAnIGJ5IHVzZXIgJyArIHJlcS5ib2R5LmNvbW1lbnQudXNlci5sb2dpbiArICdcXG4gVGhlIGNvbW1lbnQgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuY29tbWVudC5odG1sX3VybCArICcuIFxcbiBUaGUgY29udGVudCBvZiB0aGUgY29tbWVudCBpcyA6IFxcbicgKyByZXEuYm9keS5jb21tZW50LmJvZHk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlcS5ib2R5LmFjdGlvbiA9PT0gJ2RlbGV0ZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdDb21tZW50IGNvbnRlbnQgOiBfXCInICsgcmVxLmJvZHkuY29tbWVudC5ib2R5ICsgJ1wiX1xcblRoZSBhYm92ZSBjb21tZW50IHdhcyBkZWxldGVkIHVuZGVyIGlzc3VlICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJyBieSB1c2VyICcgKyByZXEuYm9keS5jb21tZW50LnVzZXIubG9naW4gKyAnIGluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCBJRCA6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9IHJlcS5ib2R5LmFjdGlvbiArICcgYWN0aW9uIG5vdCBjb2RlZCB5ZXQuLi5jb21pbmcgc29vbidcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL0lTU1VFU1xuICAgICAgICAgICAgZWxzZSBpZiAocmVxLmdldCgnWC1HaXRodWItRXZlbnQnKSA9PT0gJ2lzc3VlcycpIHtcbiAgICAgICAgICAgICAgICBsb2coJ2FjdGlvbjogJyArIHJlcS5ib2R5LmFjdGlvbilcblxuICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSA9ICdBbiBpc3N1ZSBoYXMganVzdCBiZWVuICdcblxuICAgICAgICAgICAgICAgIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdvcGVuZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnb3BlbmVkIGluIHJlcG9zaXRvcnkgJyArIHJlcS5ib2R5LnJlcG9zaXRvcnkubmFtZSArICcgd2l0aCByZXBvIGlkOiAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5pZCArICdcXG5Jc3N1ZSBEZXRhaWxzOlxcbklzc3VlIElEIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZXEuYm9keS5pc3N1ZS5sYWJlbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuVGhlIGZvbGxvd2luZyBsYWJlbHMgd2VyZSBhZGRlZDogJ1xuICAgICAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9ICdcXG5cXHQnICsgcmVxLmJvZHkuaXNzdWUubGFiZWxzW2ldLm5hbWUgKyAnXFxuJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuIElzc3VlIG9wZW5lZCBieSA6ICcgKyByZXEuYm9keS5pc3N1ZS51c2VyLmxvZ2luICsgJ1xcbiBUaGUgSXNzdWUgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuaXNzdWUuaHRtbF91cmwgKyAnLic7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXEuYm9keS5hY3Rpb24gPT09ICdjbG9zZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnY2xvc2VkLiAnICsgJ1xcbklzc3VlIERldGFpbHM6XFxuSXNzdWUgTnVtYmVyIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZSArICdcXG4gSXNzdWUgY2xvc2VkIGJ5IDogJyArIHJlcS5ib2R5Lmlzc3VlLnVzZXIubG9naW4gKyAnXFxuSW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJy4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAncmVvcGVuZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAncmVvcGVuZWQgaW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJ1xcbiBJc3N1ZSBSZS1vcGVuZWQgYnkgOiAnICsgcmVxLmJvZHkuaXNzdWUudXNlci5sb2dpbiArICdcXG5Jc3N1ZSBEZXRhaWxzOlxcbklzc3VlIElEIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZSArICdcXG4gVGhlIElzc3VlIGNhbiBiZSBmb3VuZCBoZXJlIDogJyArIHJlcS5ib2R5Lmlzc3VlLmh0bWxfdXJsICsgJy4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAnbGFiZWxlZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlID0gJ0lzc3VlIElEIDogIycgKyByZXEuYm9keS5pc3N1ZS5udW1iZXIgKyAnXFxuSXNzdWUgVGl0bGU6ICcgKyByZXEuYm9keS5pc3N1ZS50aXRsZSArICcgaGFzIGJlZW4gdXBkYXRlZCB3aXRoIHRoZSBmb2xsb3dpbmcgbGFiZWxzOiAnO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlcS5ib2R5Lmlzc3VlLmxhYmVscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgRmluYWxNZXNzYWdlICs9ICdcXG5cXHQnICsgcmVxLmJvZHkuaXNzdWUubGFiZWxzW2ldLm5hbWUgKyAnXFxuJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnSW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJ1xcbiBMYWJlbCBhZGRlZCBieSA6ICcgKyByZXEuYm9keS5pc3N1ZS51c2VyLmxvZ2luICsgJ1xcbiBUaGUgSXNzdWUgY2FuIGJlIGZvdW5kIGhlcmUgOiAnICsgcmVxLmJvZHkuaXNzdWUuaHRtbF91cmwgKyAnIC4nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLmJvZHkuYWN0aW9uID09PSAndW5sYWJlbGVkJykge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgPSAnVGhlIGZvbGxvd2luZyBsYWJlbCA6IFxcblxcdCcgKyByZXEuYm9keS5sYWJlbC5uYW1lO1xuXG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnXFxuIEhhcyBiZWVuIHJlbW92ZWQgZnJvbSBJc3N1ZSBJRCA6ICMnICsgcmVxLmJvZHkuaXNzdWUubnVtYmVyICsgJ1xcbklzc3VlIFRpdGxlOiAnICsgcmVxLmJvZHkuaXNzdWUudGl0bGU7XG4gICAgICAgICAgICAgICAgICAgIEZpbmFsTWVzc2FnZSArPSAnSW4gcmVwb3NpdG9yeSAnICsgcmVxLmJvZHkucmVwb3NpdG9yeS5uYW1lICsgJyB3aXRoIHJlcG8gaWQ6ICcgKyByZXEuYm9keS5yZXBvc2l0b3J5LmlkICsgJ1xcbiBMYWJlbCByZW1vdmVkIGJ5IDogJyArIHJlcS5ib2R5Lmlzc3VlLnVzZXIubG9naW4gKyAnXFxuIFRoZSBJc3N1ZSBjYW4gYmUgZm91bmQgaGVyZSA6ICcgKyByZXEuYm9keS5pc3N1ZS5odG1sX3VybCArICcgLic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgPSByZXEuYm9keS5hY3Rpb24gKyAnIGFjdGlvbiBub3QgY29kZWQgeWV0Li4uY29taW5nIHNvb24nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbG9nKCdFdmVudCB0eXBlOiAnICsgcmVxLmdldCgnWC1HaXRodWItRXZlbnQnKSlcbiAgICAgICAgICAgICAgICBGaW5hbE1lc3NhZ2UgPSAnRXZlbnQgdHlwZSA6ICcgKyByZXEuZ2V0KCdYLUdpdGh1Yi1FdmVudCcpICsgJyBpbiBib2FyZC4gKE5PVCBjb2RlZCB5ZXQuLi5Db21pbmcgc29vbiknXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2coRmluYWxNZXNzYWdlKVxuICAgICAgICAgICAgcmV0dXJuIEZpbmFsTWVzc2FnZTtcbiAgICAgICAgfSk7XG4gICAgfSlcbn07XG4iXX0=